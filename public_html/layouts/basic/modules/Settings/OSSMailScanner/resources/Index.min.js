'use strict';

/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */"use strict";jQuery.Class("Settings_OSSMailScanner_Index_Js",{},{registerEvents:function registerEvents(){var thisIstance=this,container=jQuery(".contentsDiv");$(".alert").alert(),jQuery("select[id^='user_list_']").on("change",function(){thisIstance.saveCRMuser(jQuery(this).data("user"),jQuery(this).val());}),jQuery("#email_search").on("change",function(){thisIstance.saveEmailSearchList(jQuery("#email_search").val());}),container.find(".js-page-num").on("change",function(){thisIstance.reloadLogTable($(this).val()-1);}),container.find(".js-run-cron").on("click",function(){var buttonInstance=$(this);app.showNotify({text:app.vtranslate("start_cron"),type:"info",animation:"show"}),buttonInstance.attr("disabled",!0);var ajaxParams={};ajaxParams.data={module:"OSSMailScanner",action:"Cron"},ajaxParams.async=!0,AppConnector.request(ajaxParams).done(function(data){var params={};params=data.success&&"ok"===data.result?{text:app.vtranslate("end_cron_ok"),type:"info",animation:"show"}:{title:app.vtranslate("end_cron_error"),text:data.result,type:"error",animation:"show"},app.showNotify(params),buttonInstance.attr("disabled",!1),thisIstance.reloadLogTable(container.find(".js-page-num").val()-1);});}),container.on("click",".js-stop-cron",function(e){var ajaxParams={},scanId=$(e.currentTarget).data("scan-id");ajaxParams.data={module:"OSSMailScanner",action:"RestartCron",scanId:scanId},ajaxParams.async=!0,AppConnector.request(ajaxParams).done(function(data){data.success&&(app.showNotify({text:data.result.data,type:"info",animation:"show"}),container.find(".js-run-cron").attr("disabled",!1));}),thisIstance.reloadLogTable(container.find(".js-page-num").val()-1);});},saveActions:function saveActions(userid,vale){AppConnector.request({module:"OSSMailScanner",action:"SaveActions",userid:userid,vale:vale}).done(function(data){var response=data.result;response.success?app.showNotify({text:response.data,type:"info"}):app.showNotify({text:response.data,type:"error"});});},saveCRMuser:function saveCRMuser(userid,value){AppConnector.request({module:"OSSMailScanner",action:"SaveCRMuser",mode:"user",userid:userid,value:value}).done(function(data){var response=data.result;response.success?app.showNotify({text:response.data,type:"info"}):app.showNotify({text:response.data,type:"error"});});},isEmpty:function isEmpty(val){return !val&&0!==val?"":val},saveEmailSearchList:function saveEmailSearchList(vale){AppConnector.request({module:"OSSMailScanner",action:"SaveEmailSearchList",vale:vale}).done(function(data){var response=data.result;response.success?app.showNotify({text:response.data,type:"info"}):app.showNotify({text:response.data,type:"error"});});},/**
		 * Function to reload table with given data from request
		 * @param {int} page
		 */reloadLogTable:function reloadLogTable(page){var self=this,container=$(".contentsDiv");AppConnector.request({module:"OSSMailScanner",action:"GetLog",start_number:page*30}).done(function(data){if(data.success){var tab=container.find("table.js-log-list");tab.find("tbody tr").remove();for(var html,i=0;i<data.result.length;i++)html="<tr><td class=\"p-1\">"+self.isEmpty(data.result[i].id)+"</td><td class=\"p-1\">"+self.isEmpty(data.result[i].start_time)+"</td><td class=\"p-1\">"+self.isEmpty(data.result[i].end_time)+"</td><td class=\"p-1\">"+self.isEmpty(app.vtranslate(data.result[i].status))+"</td><td class=\"p-1\">"+self.isEmpty(data.result[i].user)+"</td><td class=\"p-1\">"+self.isEmpty(data.result[i].count)+"</td><td class=\"p-1\">"+self.isEmpty(data.result[i].stop_user)+"</td><td class=\"p-1\">"+self.isEmpty(data.result[i].action)+"</td><td class=\"p-1\">"+self.isEmpty(data.result[i].info)+"</td><td>","In progress"===data.result[i].status&&(html+="<button type=\"button\" class=\"btn btn-danger js-stop-cron\" data-scan-id=\""+data.result[i].id+"\"",container.find(".js-run-cron").data("button-status")&&(html+=" disabled"),html+=">"+app.vtranslate("JS_StopCron")+"</button>"),html+="</td></tr>",tab.append(html);}});}});
//# sourceMappingURL=Index.min.js.map
