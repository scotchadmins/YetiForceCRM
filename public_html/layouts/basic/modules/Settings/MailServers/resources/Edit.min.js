'use strict';

/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */"use strict";jQuery.Class("Settings_MailServers_Edit_Js",{},{container:!1,advanceFilterInstance:!1,conditionBuilders:[],setContainer:function setContainer(container){return this.container=container,this.container},getContainer:function getContainer(){return !1==this.container&&(this.container=jQuery("div.contentsDiv form")),this.container},/**
		 * Register submit event
		 */registerSubmitEvent:function registerSubmitEvent(){var _this=this;this.container.off("submit").on("submit",function(e){if(e.preventDefault(),_this.container.find(".js-toggle-panel").find(".js-block-content").removeClass("d-none"),$(e.currentTarget).validationEngine("validate")){for(var key in document.progressLoader=$.progressIndicator({message:app.vtranslate("JS_SAVE_LOADER_INFO"),position:"html",blockInfo:{enabled:!0}}),_this.conditionBuilders)_this.container.find("input[name=\"".concat(key,"\"]")).val(JSON.stringify(_this.conditionBuilders[key].getConditions()));_this.preSaveValidation().done(function(response){if(!0===response){var formData=_this.container.serializeFormData();app.saveAjax("save",[],formData).done(function(data){data.result&&data.result.success?(Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate("JS_SAVE_SUCCESS")}),window.location.href=data.result.url):(document.progressLoader.progressIndicator({mode:"hide"}),app.showNotify({text:app.vtranslate("JS_ERROR"),type:"error"}));}).fail(function(){document.progressLoader.progressIndicator({mode:"hide"}),app.showNotify({text:app.vtranslate("JS_ERROR"),type:"error"});});}else document.progressLoader.progressIndicator({mode:"hide"});});}return e.stopPropagation(),!1});},/**
		 * PreSave validation
		 */preSaveValidation:function preSaveValidation(){var _this2=this,aDeferred=$.Deferred(),formData=new FormData(this.container[0]);return formData.append("mode","preSaveValidation"),AppConnector.request({async:!1,url:"index.php",type:"POST",data:formData,processData:!1,contentType:!1}).done(function(data){var response=data.result;for(var i in response)!0!==response[i].result&&(app.showNotify({text:response[i].message?response[i].message:app.vtranslate("JS_ERROR"),type:"error"}),null!=response[i].hoverField&&_this2.container.find("[name=\""+response[i].hoverField+"\"]").focus());aDeferred.resolve(0>=data.result.length);}).fail(function(textStatus,errorThrown){app.showNotify({text:app.vtranslate("JS_ERROR"),type:"error"}),app.errorLog(textStatus,errorThrown),aDeferred.resolve(!1);}),aDeferred.promise()},changeAuthMethod:function changeAuthMethod(){var _this3=this;this.container.find("[name=\"auth_method\"]").on("change",function(e){var value=e.currentTarget.value;console.log(value);var clientFields=_this3.container.find("[name=\"oauth_provider\"],[name=\"client_id\"],[name=\"client_secret\"],[name=\"redirect_uri_id\"]").closest(".js-field-container");console.log(clientFields),"oauth2"===value?clientFields.removeClass("d-none"):clientFields.addClass("d-none");});},registerBasicEvents:function registerBasicEvents(){this.container.validationEngine(app.validationEngineOptionsForRecord),this.registerSubmitEvent(),this.changeAuthMethod(),app.registerBlockToggleEvent(this.container),App.Fields.Password.register(this.container),App.Fields.Text.registerCopyClipboard(this.container);},registerEvents:function registerEvents(){this.setContainer($(".contentsDiv form")),this.registerBasicEvents(),app.showPopoverElementView(this.container.find(".js-popover-tooltip"));}});
//# sourceMappingURL=Edit.min.js.map
